<!doctype html>
<html>
<head>
	<style type="text/css">
		img {display: none;}
	</style>
</head>
<body>
	<img id="parquet" src="tiles/parquet.jpg">
	<img id="character" src="tiles/character.png">
	<img id="wall" src="tiles/wall.png">
<canvas id="canvas" width="640" height="480" style="position: absolute; top: 50%; left: 50%; margin-left: -320px; margin-top: -240px; background-color: silver;"></canvas>
<script type="text/javascript">	
var level = [
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

var tiles = [document.getElementById("parquet"), document.getElementById("wall")]
var tileSize = 32;

var character = function(x, y) {
	this.x = x;
	this.y = y;
	this.tile = document.getElementById("character");
	this.gold = 0;
	this.health = 100;
	this.monsterKilled = 0;
}

var ctx = document.getElementById("canvas").getContext("2d");
var randomCharacter = new character(4,4);
var time = 0;
window.onkeydown = function(keyObj) {
	var direction = keyObj.keyIdentifier.toLowerCase();
	moveCharacter(randomCharacter, direction);
}

function main() {
	time += 0.5;
	render(randomCharacter);
}

function render(randomCharacter) {
	for (var x = 0; x < level.length; x++) {
		for (var y = 0; y < level[x].length; y++) {
			if (level[x][y] === 0) {
				if (x === randomCharacter.x && y === randomCharacter.y) {
					ctx.drawImage(tiles[0], y * tileSize, x * tileSize);	
					ctx.drawImage(randomCharacter.tile, y * tileSize, x * tileSize);
				} else {
					// parquet
					ctx.drawImage(tiles[0], y * tileSize, x * tileSize);	
				}
			} else {
				// wall
				ctx.drawImage(tiles[1], y * tileSize, x * tileSize);	
			}
		}
	}
}

function moveCharacter(randomCharacter, direction) {
	var maxY = level[0].length - 1;
	var maxX = level.length - 1;
	var currentY = randomCharacter.y;
	var currentX = randomCharacter.x;
	
	switch (direction) {
		case 'up':
			if (level[currentX - 1][currentY] === 0) {
				randomCharacter.x--;
			}
			break;
		case 'down':
			if (level[currentX + 1][currentY] === 0) {
				randomCharacter.x++;
			}
			break;
		case 'left':
			if (level[currentX][currentY - 1] === 0) {
				randomCharacter.y--;
			}
			break;
		case 'right':
			if (level[currentX][currentY + 1] === 0) {
				randomCharacter.y++;
			}
			break;
	}
}

window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
})();

(function animloop(){
  requestAnimFrame(animloop);
  main();
})();
</script>
</body>
</html>